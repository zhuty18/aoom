---
import { getCollection } from "astro:content"

import BasicPage from "../../../layouts/BasicPage.astro"
import Post from "../../../components/Post.astro"
import { cateName } from "../../../consts"

export async function getStaticPaths() {
  const allPosts = await getCollection("blog")
  const categories = [
    ...new Set(
      allPosts.map((post) => {
        return post.id.split("/")[0]
      })
    ),
  ]

  return categories.map((cate) => ({
    params: { cate },
    props: {
      posts: allPosts.filter((post) => post.id.startsWith(cate + "/")),
    },
  }))
}

const { cate } = Astro.params
const { posts } = Astro.props
const cateKey = cate as keyof typeof cateName
---

<BasicPage title={cateName[cateKey]}>
  {posts.map((post) => <Post post={post} />)}
</BasicPage>
